#!/bin/bash

check_repo() {
  if ! [ -d "$1" ] || ! [ -d "$1/.git" ]; then
    echo "Provide a local git repository" >&2
    exit 1
  fi

  # if ! cd "$1"; then
  #   echo "Cannot cd in $0" >&2
  #   echo "Missing execution permissions ?" >&2
  #   exit 1
  # fi

  if ! [ "$(git -C "$1" remote)" ]; then
    echo "Missing remote server: $1" >&2
  fi
}

if [ "$1" ]; then
  repo="$1"
else
  repo="$HOME/Notes"
fi

check_repo "$repo"

git -C "$repo" pull &&
  $EDITOR "$repo" &&
  git -C "$repo" add . &&
  git -C "$repo" commit &&
  git -C "$repo" push
